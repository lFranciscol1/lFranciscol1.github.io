
CREATE DATABASE CORPDATA;

USE CORPDATA;

# EMPLOYEE

CREATE TABLE EMPLOYEE
      (EMPNO       CHAR(6)         NOT NULL,
       FIRSTNME    VARCHAR(12)     NOT NULL,
       MIDINIT     CHAR(1)         NOT NULL,
       LASTNAME    VARCHAR(15)     NOT NULL,
       WORKDEPT    CHAR(3)                 ,
       PHONENO     CHAR(4)                 ,
       HIREDATE    DATE                    ,
       JOB         CHAR(8)                 ,
       EDLEVEL     SMALLINT        NOT NULL,
       SEX         CHAR(1)                 ,
       BIRTHDATE   DATE                    ,
       SALARY      DECIMAL(9,2)            ,
       BONUS       DECIMAL(9,2)            ,
       COMM        DECIMAL(9,2)   			,      
       PRIMARY KEY (EMPNO))
       
         
      
ALTER TABLE EMPLOYEE 
      ADD FOREIGN KEY RED (WORKDEPT) 
      REFERENCES DEPARTMENT (DEPTNO)
      ON DELETE SET NULL

ALTER TABLE EMPLOYEE 
      ADD CONSTRAINT NUMBER 
      CHECK (PHONENO >= '0000' AND PHONENO <= '9999')

# -------------------

    
ALTER TABLE EMPLOYEE
DROP FOREIGN KEY RED;  
      
# creacion de indices 

      
CREATE UNIQUE INDEX XEMP1 
       ON EMPLOYEE (EMPNO)

CREATE INDEX XEMP2 
       ON EMPLOYEE (WORKDEPT)
       



# DEPARTMENT

CREATE TABLE DEPARTMENT
      (DEPTNO    CHAR(3)           NOT NULL,
       DEPTNAME  VARCHAR(36)       NOT NULL,
       MGRNO     CHAR(6)                   ,
       ADMRDEPT  CHAR(3)           NOT NULL, 
       LOCATION  CHAR(16),
       PRIMARY KEY (DEPTNO))


ALTER TABLE DEPARTMENT
      ADD FOREIGN KEY ROD (ADMRDEPT)
          REFERENCES DEPARTMENT
          ON DELETE CASCADE
          


# ---------------------------
CREATE TABLE PROJECT
      (PROJNO    CHAR(6)        NOT NULL,
       PROJNAME  VARCHAR(24)    NOT NULL,
       DEPTNO    CHAR(3)        NOT NULL,
       RESPEMP   CHAR(6)        NOT NULL,
       PRSTAFF   DECIMAL(5,2)           ,
       PRSTDATE  DATE                   ,
       PRENDATE  DATE                   ,
       MAJPROJ   CHAR(6)                ,
       PRIMARY KEY (PROJNO))

ALTER TABLE PROJECT 
              ADD FOREIGN KEY (DEPTNO) 
              REFERENCES DEPARTMENT (DEPTNO) 
              ON DELETE RESTRICT

ALTER TABLE PROJECT 
              ADD FOREIGN KEY (RESPEMP) 
              REFERENCES employee (EMPNO)
              ON DELETE RESTRICT


ALTER TABLE PROJECT 
              ADD FOREIGN KEY  RPP (MAJPROJ) 
              REFERENCES PROJECT (PROJNO)
              ON DELETE CASCADE
              
              
              



# datos para EMPLOYEE

INSERT INTO EMPLOYEE (EMPNO, FIRSTNME, MIDINIT, LASTNAME, WORKDEPT, PHONENO, HIREDATE, JOB, EDLEVEL, SEX, BIRTHDATE, SALARY, BONUS, COMM)
VALUES
('000010', 'CHRISTINE', 'I', 'HAAS', 'A00', '3978', '1965-01-01', 'PRES', 18, 'F', '1933-08-24', 52750.00, 1000.00, 4220.00),
('000020', 'MICHAEL', 'L', 'THOMPSON', 'B01', '3476', '1973-10-10', 'MANAGER', 18, 'M', '1948-02-02', 41250.00, 800.00, 3300.00),
('000030', 'SALLY', 'A', 'KWAN', 'C01', '4738', '1975-04-05', 'MANAGER', 20, 'F', '1941-05-11', 38250.00, 800.00, 3060.00),
('000050', 'JOHN', 'B', 'GEYER', 'E01', '6789', '1949-08-17', 'MANAGER', 16, 'M', '1925-09-15', 40175.00, 800.00, 3214.00),
('000060', 'IRVING', 'F', 'STERN', 'D11', '6423', '1973-09-14', 'MANAGER', 16, 'M', '1945-07-07', 32250.00, 500.00, 2580.00),
('000070', 'EVA', 'D', 'PULASKI', 'D21', '7831', '1980-09-30', 'MANAGER', 16, 'F', '1953-05-26', 36170.00, 700.00, 2893.00),
('000090', 'EILEEN', 'W', 'HENDERSON', 'E11', '5498', '1970-08-15', 'MANAGER', 16, 'F', '1941-05-15', 29750.00, 600.00, 2380.00),
('000100', 'THEODORE', 'Q', 'SPENSER', 'E21', '0972', '1980-06-19', 'MANAGER', 14, 'M', '1956-12-18', 26150.00, 500.00, 2092.00),
('000110', 'VINCENZO', 'G', 'LUCCHESSI', 'A00', '3490', '1958-05-16', 'SALESREP', 19, 'M', '1929-11-05', 46500.00, 900.00, 3720.00),
('000120', 'SEAN', '', "O'CONNELL", 'A00', '2167', '1963-12-05', 'CLERK', 14, 'M', '1942-10-18', 29250.00, 600.00, 2340.00),
('000130', 'DOLORES', 'M', 'QUINTANA', 'C01', '4578', '1971-07-28', 'ANALYST', 16, 'F', '1925-09-15', 23800.00, 500.00, 1904.00),
('000140', 'HEATHER', 'A', 'NICHOLLS', 'C01', '1793', '1976-12-15', 'ANALYST', 18, 'F', '1946-01-19', 28420.00, 600.00, 2274.00),
('000150', 'BRUCE', '', 'ADAMSON', 'D11', '4510', '1972-02-12', 'DESIGNER', 16, 'M', '1947-05-17', 25280.00, 500.00, 2022.00),
('000160', 'ELIZABETH', 'R', 'PIANKA', 'D11', '3782', '1977-10-11', 'DESIGNER', 17, 'F', '1955-04-12', 22250.00, 400.00, 1780.00),
('000170', 'MASATOSHI', 'J', 'YOSHIMURA', 'D11', '2890', '1978-09-15', 'DESIGNER', 16, 'M', '1951-01-05', 24680.00, 500.00, 1974.00),
('000180', 'MARILYN', 'S', 'SCOUTTEN', 'D11', '1682', '1973-07-07', 'DESIGNER', 17, 'F', '1949-02-21', 21340.00, 500.00, 1707.00),
('000190', 'JAMES', 'H', 'WALKER', 'D11', '2986', '1974-07-26', 'DESIGNER', 16, 'M', '1952-06-25', 20450.00, 400.00, 1636.00),
('000200', 'DAVID', '', 'BROWN', 'D11', '4501', '1966-03-03', 'DESIGNER', 16, 'M', '1941-05-29', 27740.00, 600.00, 2217.00),
('000210', 'WILLIAM', 'T', 'JONES', 'D11', '0942', '1979-04-11', 'DESIGNER', 17, 'M', '1953-02-23', 18270.00, 400.00, 1462.00),
('000220', 'JENNIFER', 'K', 'LUTZ', 'D11', '0672', '1968-08-29', 'DESIGNER', 18, 'F', '1948-03-19', 29840.00, 600.00, 2387.00),
('000230', 'JAMES', 'J', 'JEFFERSON', 'D21', '2094', '1966-11-21', 'CLERK', 14, 'M', '1935-05-30', 22180.00, 400.00, 1774.00),
('000240', 'SALVATORE', 'M', 'MARINO', 'D21', '3780', '1979-12-05', 'CLERK', 17, 'M', '1954-03-31', 28760.00, 600.00, 2301.00),
('000250', 'DANIEL', 'S', 'SMITH', 'D21', '0961', '1969-10-30', 'CLERK', 15, 'M', '1939-11-12', 19180.00, 400.00, 1534.00),
('000260', 'SYBIL', 'P', 'JOHNSON', 'D21', '8953', '1975-09-11', 'CLERK', 16, 'F', '1936-10-05', 17250.00, 300.00, 1380.00),
('000270', 'MARIA', 'L', 'PEREZ', 'D21', '9001', '1980-09-30', 'CLERK', 15, 'F', '1953-05-26', 27380.00, 500.00, 2190.00),
('000280', 'ETHEL', 'R', 'SCHNEIDER', 'E11', '8997', '1967-03-24', 'OPERATOR', 17, 'F', '1936-03-28', 26250.00, 500.00, 2100.00),
('000290', 'JOHN', 'R', 'PARKER', 'E11', '4502', '1980-05-30', 'OPERATOR', 12, 'M', '1946-07-09', 15340.00, 300.00, 1227.00),
('000300', 'PHILIP', 'X', 'SMITH', 'E11', '2095', '1972-06-19', 'OPERATOR', 14, 'M', '1936-10-27', 17750.00, 400.00, 1420.00),
('000310', 'MAUDE', 'F', 'SETRIGHT', 'E11', '3332', '1964-09-12', 'OPERATOR', 12, 'F', '1931-04-21', 15900.00, 300.00, 1272.00),
('000320', 'RAMLAL', 'V', 'MEHTA', 'E21', '9990', '1965-07-07', 'FILEREP', 16, 'M', '1932-08-11', 19950.00, 400.00, 1596.00),
('000330', 'WING', '', 'LEE', 'E21', '2103', '1976-02-23', 'FILEREP', 14, 'M', '1941-07-18', 25370.00, 500.00, 2030.00),
('000340', 'JASON', 'R', 'GOUNOT', 'E21', '5698', '1947-05-05', 'FILEREP', 16, 'M', '1926-05-17', 23840.00, 500.00, 1907.00),
('200010', 'DIAN', 'J', 'HEMMINGER', 'A00', '3978', '1965-01-01', 'SALESREP', 18, 'F', '1933-08-14', 46500.00, 1000.00, 4220.00),
('200120', 'GREG', '', 'ORLANDO', 'A00', '2167', '1972-05-05', 'CLERK', 14, 'M', '1942-10-18', 29250.00, 600.00, 2340.00),
('200140', 'KIM', 'N', 'NATZ', 'C01', '1793', '1976-12-15', 'ANALYST', 18, 'F', '1946-01-19', 28420.00, 600.00, 2274.00),
('200170', 'KIYOSHI', '', 'YAMAMOTO', 'D11', '2890', '1978-09-15', 'DESIGNER', 16, 'M', '1951-01-05', 24680.00, 500.00, 1974.00),
('200220', 'REBA', 'K', 'JOHN', 'D11', '0672', '1968-08-29', 'DESIGNER', 18, 'F', '1948-03-19', 29840.00, 600.00, 2387.00),
('200240', 'ROBERT', 'M', 'MONTEVERDE', 'D21', '3780', '1979-12-05', 'CLERK', 17, 'M', '1954-03-31', 28760.00, 600.00, 2301.00),
('200280', 'EILEEN', 'R', 'SCHWARTZ', 'E11', '8997', '1967-03-24', 'OPERATOR', 17, 'F', '1936-03-28', 26250.00, 500.00, 2100.00),
('200310', 'MICHELLE', 'F', 'SPRINGER', 'E11', '3332', '1964-09-12', 'OPERATOR', 12, 'F', '1931-04-21', 15900.00, 300.00, 1272.00),
('200330', 'HELENA', '', 'WONG', 'E21', '2103', '1976-02-23', 'FIELDREP', 14, 'F', '1941-07-18', 25370.00, 500.00, 2030.00),
('200340', 'ROY', 'R', 'ALONZO', 'E21', '5698', '1947-05-05', 'FIELDREP', 16, 'M', '1926-05-17', 23840.00, 500.00, 1907.00);



# datos de deprtment

INSERT INTO DEPARTMENT (DEPTNO, DEPTNAME, MGRNO, ADMRDEPT, LOCATION)
VALUES
('A00', 'SPIFFY COMPUTER SERVICE DIV.', '000010', 'A00', NULL),
('B01', 'PLANNING', '000020', 'A00', NULL),
('C01', 'INFORMATION CENTER', '000030', 'A00', NULL),
('D01', 'DEVELOPMENT CENTER', NULL, 'A00', NULL),
('D11', 'MANUFACTURING SYSTEMS', '000060', 'D01', NULL),
('D21', 'ADMINISTRATION SYSTEMS', '000070', 'D01', NULL),
('E01', 'SUPPORT SERVICES', '000050', 'A00', NULL),
('E11', 'OPERATIONS', '000090', 'E01', NULL),
('E21', 'SOFTWARE SUPPORT', '000100', 'E01', NULL),
('F22', 'BRANCH OFFICE F2', NULL, 'E01', NULL),
('G22', 'BRANCH OFFICE G2', NULL, 'E01', NULL),
('H22', 'BRANCH OFFICE H2', NULL, 'E01', NULL),
('I22', 'BRANCH OFFICE I2', NULL, 'E01', NULL),
('J22', 'BRANCH OFFICE J2', NULL, 'E01', NULL);


# proyectos

INSERT INTO PROJECT (PROJNO, PROJNAME, DEPTNO, RESPEMP, PRSTAFF, PRSTDATE, PRENDATE, MAJPROJ)
VALUES
('AD3100', 'ADMIN SERVICES', 'D01', '000010', 6.5, '1982-01-01', '1983-02-01', NULL),
('AD3110', 'GENERAL ADMIN SYSTEMS', 'D21', '000070', 6, '1982-01-01', '1983-02-01', 'AD3100'),
('AD3111', 'PAYROLL PROGRAMMING', 'D21', '000230', 2, '1982-01-01', '1983-02-01', 'AD3110'),
('AD3112', 'PERSONNEL PROGRAMMING', 'D21', '000250', 1, '1982-01-01', '1983-02-01', 'AD3110'),
('AD3113', 'ACCOUNT PROGRAMMING', 'D21', '000270', 2, '1982-01-01', '1983-02-01', 'AD3110'),
('IF1000', 'QUERY SERVICES', 'C01', '000030', 2, '1982-01-01', '1983-02-01', NULL),
('IF2000', 'USER EDUCATION', 'C01', '000030', 1, '1982-01-01', '1983-02-01', NULL),
('MA2100', 'WELD LINE AUTOMATION', 'D01', '000010', 12, '1982-01-01', '1983-02-01', NULL),
('MA2110', 'W L PROGRAMMING', 'D11', '000060', 9, '1982-01-01', '1983-02-01', 'MA2100'),
('MA2111', 'W L PROGRAM DESIGN', 'D11', '000220', 2, '1982-01-01', '1982-12-01', 'MA2110'),
('MA2112', 'W L ROBOT DESIGN', 'D11', '000150', 3, '1982-01-01', '1982-12-01', 'MA2110'),
('MA2113', 'W L PROD CONT PROGS', 'D11', '000160', 3, '1982-02-15', '1982-12-01', 'MA2110'),
('OP1000', 'OPERATION SUPPORT', 'E01', '000050', 6, '1982-01-01', '1983-02-01', NULL),
('OP1010', 'OPERATION', 'E11', '000090', 5, '1982-01-01', '1983-02-01', 'OP1000'),
('OP2000', 'GEN SYSTEMS SERVICES', 'E01', '000050', 5, '1982-01-01', '1983-02-01', NULL),
('OP2010', 'SYSTEMS SUPPORT', 'E21', '000100', 4, '1982-01-01', '1983-02-01', 'OP2000'),
('OP2011', 'SCP SYSTEMS SUPPORT', 'E21', '000320', 1, '1982-01-01', '1983-02-01', 'OP2010'),
('OP2012', 'APPLICATIONS SUPPORT', 'E21', '000330', 1, '1982-01-01', '1983-02-01', 'OP2010'),
('OP2013', 'DB/DC SUPPORT', 'E21', '000340', 1, '1982-01-01', '1983-02-01', 'OP2010'),
('PL2100', 'WELD LINE PLANNING', 'B01', '000020', 1, '1982-01-01', '1982-09-15', 'MA2100');





Tarea 2:
SELECT AVG(salary) FROM employee 
SELECT MAX(salary),MIN(Salary) FROM employee WHERE WORKDEPT = "D11"
SELECT avg(TIMESTAMPDIFF(YEAR,BIRTHDATE,CURDATE())) AS edad
     FROM employee;
	 
practica:
SELECT EMPNO,LASTNAME,DEPTNO,DEPTNAME FROM department,employee WHERE employee.WORKDEPT = department.DEPTNO


SELECT p.PROJNO,p.PROJNAME,d.DEPTNO,d.DEPTNAME,d.MGRNO,e.EMPNO,e.FIRSTNME,e.MIDINIT,e.LASTNAME FROM project p,department d,employee e 
WHERE e.WORKDEPT = p.DEPTNO AND e.EMPNO = d.MGRNO 
AND d.DEPTNO = "D21"
AND d.MGRNO = "000070"

SELECT p.PROJNO,p.PROJNAME,d.DEPTNO,d.DEPTNAME,d.MGRNO,e.EMPNO,e.FIRSTNME,e.MIDINIT,e.LASTNAME FROM department d JOIN project p JOIN employee e 
ON E.WORKDEPT = p.DEPTNO AND e.EMPNO = d.MGRNO 
AND d.DEPTNO = "D21"
AND d.MGRNO = "000070"

SELECT e.EMPNO,e.LASTNAME,e.WORKDEPT,e.BIRTHDATE,d.DEPTNO,d.MGRNO,m.EMPNO,m.LASTNAME,m.BIRTHDATE FROM employee e 
JOIN employee m JOIN department d ON e.WORKDEPT = d.DEPTNO AND d.MGRNO = m.EMPNO ORDER BY d.DEPTNO WHERE e.LASTNAME NOT LIKE m.LASTNAME


















Guardado

SELECT p.PROJNO,p.PROJNAME,d.DEPTNO,d.DEPTNAME,d.MGRNO,e.EMPNO,e.FIRSTNME,e.MIDINIT,e.LASTNAME FROM project p,department d,employee e 
WHERE e.WORKDEPT = p.DEPTNO AND e.EMPNO = d.MGRNO 
AND d.DEPTNO = "D21"
AND d.MGRNO = "000070"

SELECT p.PROJNO,p.PROJNAME,d.DEPTNO,d.DEPTNAME,d.MGRNO,e.EMPNO,e.FIRSTNME,e.MIDINIT,e.LASTNAME FROM department d JOIN project p JOIN employee e 
ON E.WORKDEPT = p.DEPTNO AND e.EMPNO = d.MGRNO 
AND d.DEPTNO = "D21"
AND d.MGRNO = "000070"

SELECT e.EMPNO,e.LASTNAME,e.WORKDEPT,e.BIRTHDATE,d.DEPTNO,d.MGRNO,m.EMPNO,m.LASTNAME,m.BIRTHDATE FROM employee e 
JOIN employee m JOIN department d ON e.WORKDEPT = d.DEPTNO AND d.MGRNO = m.EMPNO ORDER BY d.DEPTNO WHERE e.LASTNAME NOT LIKE m.LASTNAME

SELECT * FROM department
SELECT * FROM project
SELECT * FROM employee

SELECT e.FIRSTNME AS empleado_name, d.DEPTNAME AS nombredepartamento FROM employee e,department d WHERE e.WORKDEPT = d.DEPTNO
SELECT d.DEPTNAME AS name_dept, COUNT(e.EMPNO) AS todal_empleados FROM department d LEFT JOIN employee e ON d.DEPTNO = e.WORKDEPT GROUP BY d.DEPTNAME
SELECT d.deptname AS nombre_departamento,SUM(e.SALARY) AS totalsalario FROM department d LEFT JOIN employee e ON d.DEPTNO = e.WORKDEPT GROUP BY d.DEPTNAME
SELECT projname,prstdate,prendate,DATEDIFF(prendate,prstdate) AS dias FROM project WHERE prendate =(SELECT MIN(DATEDIFF(prendate,prstdate)) FROM project)


SELECT projname,prstdate,prendate,DATEDIFF(prendate,prstdate)
 AS dias FROM project ORDER BY DATEDIFF(prendate,prstdate) LIMIT 1
 
 
SELECT e.FIRSTNME AS nombreempleado,p.PROJNAME AS nombreproyecto FROM employee e INNER JOIN project p ON e.EMPNO =p.RESPEMP
corpdata


CREATE VIEW empleados_salarios_altos AS SELECT empno,firstnme,lastname,salary FROM employee WHERE salary > 40000.0

CREATE VIEW lista AS SELECT projno,projname,deptno,respemp FROM project

CREATE VIEW vista3 AS SELECT d.DEPTNO,d.DEPTNAME,d.MGRNO, e.FIRSTNME AS nombre_gerente, e.LASTNAME FROM department d LEFT JOIN employee e ON d.MGRNO = e.EMPNO

CREATE VIEW vista4 AS SELECT EMPNO,FIRSTNME,LASTNAME,WORKDEPT FROM employee WHERE workdept = "D11"

#tarea
#consulta 1
CREATE VIEW vistanombre AS SELECT e.FIRSTNME,p.PROJNAME FROM employee e LEFT JOIN  project p ON e.EMPNO = p.RESPEMP

#consuta 2
CREATE VIEW vista_salario_empleado AS 
SELECT e.FIRSTNME,d.DEPTNO,
(SELECT AVG(SALARY) FROM employee WHERE WORKDEPT = "D11") AS salario   FROM  department d LEFT JOIN employee e ON d.DEPTNO = e.WORKDEPT WHERE e.WORKDEPT = "D11" 
GROUP BY e.FIRSTNME

CREATE VIEW proyecto_sinempleados AS SELECT p.PROJNAME,e.FIRSTNME FROM project p LEFT JOIN employee e ON e.EMPNO = p.RESPEMP WHERE p.MAJPROJ = NULL

#practica

SELECT e.FIRSTNME,e.LASTNAME,salario.d11,d.DEPTNAME FROM employee e, department d,(SELECT AVG(SALARY) AS d11) FROM employee WHERE WORKDEPT = "D11")salario WHERE d.DEPTNO = e.WORKDEPT AND e.WORKDEPT = "D11"
SELECT * FROM empleados_salarios_altos

UPDATE empleados_salarios_altos SET salary = 45000.0 WHERE EMPNO = "000010"

DELETE FROM empleados_salarios_altos WHERE EMPNO = 000110

SELECT e.FIRSTNME,p.PROJNO,p.RESPEMP,e.SALARY FROM employee e LEFT JOIN project p ON e.EMPNO = p.RESPEMP WHERE e.SALARY > 40000.0

ALTER VIEW empleados_salarios_altos AS SELECT EMPNO,FIRSTNME,LASTNAME,SALARY FROM employee WHERE salary > 45000.0

SELECT * FROM project



CREATE VIEW empleado_nombre AS SELECT e.FIRSTNME,p.PROJNAME FROM employee e LEFT JOIN project p ON p.RESPEMP= e.audit_log


ALTER VIEW empleado_nombre AS SELECT e.FIRSTNME,d.DEPTNAME,p.PRSTDATE,p.PRENDATE FROM  employee e,project p,department d WHERE e.WORKDEPT = d.DEPTNO
DROP VIEW empleado_nombre 
CREATE VIEW resumen_salario AS SELECT d.DEPTNAME,(SELECT AVG(SALARY) FROM employee) AS salario FROM employee e LEFT JOIN department d ON e.WORKDEPT = d.DEPTNO GROUP BY d.DEPTNAME
ALTER VIEW resumen_salario AS SELECT d.DEPTNAME,(SELECT AVG(SALARY) FROM employee) AS salario,COUNT 

#practica en linea
CREATE TABLE audit_log(ID INT AUTO_INCREMENT PRIMARY KEY, 
ACTION VARCHAR(10) NOT  NULL, 
TABLE_NAME VARCHAR(50) NOT NULL,
 TIMESTAMP TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
 
 INSERT INTO audit_log(ACTION,TABLE_NAME) VALUES ('DELETE','employee')
 
 SELECT * FROM audit_log
 SELECT * FROM employee
 

 CREATE TRIGGER registrar_auditoria_insert 
 AFTER INSERT ON employee 
 FOR EACH ROW 
 INSERT INTO audit_log(ACTION,TABLE_NAME) VALUES ('INSERT','employee')
 $$
 
 INSERT INTO employee(EMPNO,FIRSTNME,MIDINIT,LASTNAME,WORKDEPT,EDLEVEL)
 VALUES('400101','FRANCISCO','A','ARVAYO','D11',16)
 
 DROP TRIGGER  registrar_auditoria_insert
 
 
 																					#INSERT TRIGGER
 DELIMITER $$
CREATE TRIGGER registrar_auditoria_insert
AFTER INSERT ON employee
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (ACTION, TABLE_NAME) VALUES ('INSERT', 'employee');
END;
$$
 	
	 
	 																			
 DELIMITER $$
CREATE TRIGGER registrar_department_insert
AFTER INSERT ON department
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (ACTION, TABLE_NAME) VALUES ('INSERT', 'department');
END;
$$



INSERT INTO department(DEPTNO,DEPTNAME,ADMRDEPT) VALUES ("B02","Telematica","D01")

SELECT * FROM department
																				#DELETE TRIGGER 

 DELIMITER $$
CREATE TRIGGER registrar_auditoria_DELETE
AFTER DELETE ON employee
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (ACTION, TABLE_NAME) VALUES ('DELETE', 'employee');
END;
$$

 DELIMITER $$
CREATE TRIGGER registrar_department_DELETE
AFTER DELETE ON department
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (ACTION, TABLE_NAME) VALUES ('DELETE', 'department');
END;
$$

DELETE FROM employee WHERE EMPNO = 400106
DELETE FROM employee WHERE EMPNO = 400105
DELETE FROM employee WHERE EMPNO = 400110

																			#UPDATE TRIGGER 
DELIMITER $$
CREATE TRIGGER registrar_proyecto_INSERT
AFTER UPDATE  ON project
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (ACTION, TABLE_NAME) VALUES ('UPDATE', 'employee');
END;
$$



UPDATE employee SET EMPNO = 000301  WHERE EMPNO = 000300
UPDATE employee SET EMPNO = 000300 WHERE EMPNO = 000301
UPDATE employee SET EMPNO = 000301 WHERE EMPNO = 000300



SELECT * FROM audit_log

 SELECT * FROM department
 
 
 INSERT INTO employee(EMPNO,FIRSTNME,MIDINIT,LASTNAME,WORKDEPT,EDLEVEL)
 VALUES('400102','Kevin','K','Borbon','D11',17)
 
  INSERT INTO employee(EMPNO,FIRSTNME,MIDINIT,LASTNAME,WORKDEPT,EDLEVEL)
 VALUES('400103','Ubaldo','U','Ibarra','D11',18)
 
 DROP TRIGGER registrar_auditoria_insert
 
 
 SELECT * FROM department
 SELECT * FROM employee 
 SELECT * FROM project
 
 CREATE VIEW empleados_depto AS 
 SELECT e.FIRSTNME,d.DEPTNAME FROM employee e LEFT JOIN department d ON e.WORKDEPT = d.DEPTNO
 
 ALTER VIEW empleados_depto AS 
SELECT e.FIRSTNME, d.DEPTNAME, p.PRSTDATE, p.PRENDATE
FROM employee e
INNER JOIN project p ON e.EMPNO = p.RESPEMP
LEFT JOIN department d ON e.WORKDEPT = d.DEPTNO

DROP VIEW empleados_depto

CREATE VIEW resumen_salario AS 
SELECT d.DEPTNAME, AVG(e.SALARY) AS salario
FROM department d
LEFT JOIN employee e ON d.DEPTNO = e.WORKDEPT
GROUP BY d.DEPTNAME;

DROP VIEW resumen_salario
ALTER VIEW resumen_salario AS SELECT d.DEPTNAME,
       COUNT(e.EMPNO) AS total_empleados,
       AVG(e.SALARY) AS salario_promedio
FROM department d
LEFT JOIN employee e ON d.DEPTNO = e.WORKDEPT
GROUP BY d.DEPTNAME;

DROP VIEW resumen_salario
